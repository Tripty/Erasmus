{% extends "base.html" %}
{% block title %}{{ post.title }} — Erasmus{% endblock %}
{% block content %}
<article class="mb-4">
  <h1>{{ post.title }}</h1>
  <p class="text-muted">
    {% if post.author %}By {{ post.author.get_username }}{% elif post.guest_name %}By {{ post.guest_name }}{% endif %}
    {% if post.published_at %} · {{ post.published_at|date:"M d, Y H:i" }}{% endif %}
  </p>
  {% if post.cover_image %}
    <img class="img-fluid rounded mb-3" src="{{ post.cover_image.url }}" alt="{{ post.title }}">
  {% endif %}
  <div class="ck-content">
    {{ post.content|safe }}
  </div>
</article>

<section class="mt-5">
  <h3>Comments</h3>
  {% for c in comments %}
    <div class="border rounded p-2 mb-2">
      <small class="text-muted d-block mb-1">
        {{ c.user.username|default:c.guest_name|default:"Anonymous" }} — {{ c.created_at|date:"M d, Y H:i" }}
      </small>
      <div>{{ c.body|linebreaks }}</div>
    </div>
  {% empty %}
    <div class="text-muted">No comments yet.</div>
  {% endfor %}

  <form class="mt-3" method="post">
    {% csrf_token %}
    {{ comment_form.non_field_errors }}
    <div class="mb-2">{{ comment_form.body.label_tag }} {{ comment_form.body }}</div>
    {% if not request.user.is_authenticated %}
      <div class="mb-2">{{ comment_form.guest_name.label_tag }} {{ comment_form.guest_name }}</div>
      <div class="mb-2">{{ comment_form.guest_email.label_tag }} {{ comment_form.guest_email }}</div>
    {% endif %}
    <button class="btn btn-primary" type="submit" name="add_comment">Add Comment</button>
  </form>
</section>
{% endblock %}
